
num_points = 9; % Number of points to mark

for n = 1:5
    % Construct the image file name
    image_file = sprintf('FixedCamera_Data/PatternImage_Orientation_%d.bmp', n);
    ima =  imread(image_file);
    [height,checkerboard_size_mm] = size(ima); % Size of the checkerboard in millimeters
    [coord{n} , ima_pattern] = get_real_points_checkerboard_vmmc(num_points, checkerboard_size_mm,2);
    
    % Read the image
    coord_target = get_user_points_vmmc(image_file);
    homography{n} = homography_solve_vmmc(coord{n}',coord_target);

    % if ~isa(homography{n}, 'double')
    %     homography{n} = double(homography{n});
    % end
    
    A{n} = internal_parameters_solve_vmmc(homography);

    

    % if ~isa(A{n}, 'double')
    %     A{n} = double(A{n});
    % end

    % A = [alfa gamma u0
    %  0	  beta  v0
    %  0	  0	    1];
    
    alpha{n} = A{n}(1,1);
    beta{n} = A{n}(2,2);
    u0{n} = A{n}(1,3);
    v0{n} = A{n}(2,3);
    gamma{n} = A{n}(1,2);

    %if gamma is zero then  "Angle, in degrees, between image axes is zero"

    %to calculate angle cos^-1(gamma/(a*b))
    angle{n} = acos(gamma{n}/(alpha{n}*beta{n}));

    if any(~isreal(A{n}(:))) || any(isnan(A{n}(:))) || any(isinf(A{n}(:)))
        disp('La matriz A contiene elementos no reales, NaN o infinitos.');
    else
        [R{n},T{n}] =  external_parameters_solve_vmmc(A{n},homography);
    end

   

    % tform = maketform('projective',homography');
    % tr_ima = imtransform(ima_pattern,tform,'XData',[1 size(ima_pattern,2)],'YData',[1 size(ima_pattern,1)]);
    % subplot(1, 5,1);
    % imshow(tr_ima);
end

%homography 3

%alpha3 = 1929.71306550814	alpha4 = 1802.03348550849	alpha5 = 1777.41232010294
%beta3 = 1964.83493439928	beta4 = 1871.63295698140	beta5 = 1854.38642435812
%u03 = 444.924525437190	u04 = 479.737118656561	u05 = 478.645913175727
%v03 = 345.627850529593	v04 = 338.467127866465	v05 = 358.607268299715
%angle3 = 1.57076945413528	angle4 = 1.57078222627975	angle5 = 1.57078176394583


%R1 [0.417401360937009,-0.584444237375641,-0.695845555627352;-0.103768780712923,-0.791386713781450,0.602444279082764;-0.902778014817201,-0.179254017105904,-0.390972957267009]

%R3 [0.785665720659593,-0.115209429108899,-0.607829057239652;-0.0336462983776112,-0.989010037888784,0.143968995136838;-0.617735624669589,-0.0926603064943534,-0.780907654985175]	[0.773336883692029,-0.0369009786650017,0.632920517991846;-0.0876609893486186,-0.994939501170892,0.0491013233654511;0.627905737565698,-0.0934543031827979,-0.772658189595305]	[-0.628830590773181,-0.161159311508692,-0.760657455377844;0.0633437712822762,0.964414487682873,-0.256694882276838;0.774957840625922,-0.209600506348208,-0.596244893471620]

%R4 [0.825828861855626,-0.137434298361526,-0.546917273963912;-0.0590086748164068,-0.985583645086033,0.158564986158170;-0.560824988051222,-0.0986746784783429,-0.822033235705554]	[0.804937669689964,-0.0654772037536172,0.589735604913505;-0.0989108059817298,-0.994793306051145,0.0245546471340632;0.585057262474482,-0.0780961844422700,-0.807223008592684]	[-0.688575403238418,-0.122297060626381,-0.714777827731945;0.0615417250329685,0.972265362765725,-0.225638384247892;0.722548635134699,-0.199357701953499,-0.661951642143747]	[0.956021903255199,0.0385905189595966,0.290745408119776;0.239565960301087,-0.674639528702625,-0.698190272760168;0.169204820148021,0.737137896297788,-0.654215140974548]

%R5 [0.836548845432447,-0.135749553910834,-0.530808899528493;-0.0481892471351072,-0.983295193219881,0.175523102329093;-0.545769022266922,-0.121254367359231,-0.829116127409256]	[0.825663512687483,-0.109719717108416,0.553390772866893;-0.137659562988623,-0.990438560030382,0.00901684660652963;0.547110234353507,-0.0836244131973040,-0.832872948884197]	[-0.711409424714049,-0.129253320825258,-0.690789555135042;0.0256867802935189,0.977502565467708,-0.209353585644484;0.702308208514025,-0.166680273456977,-0.692084436101643]	[0.964626224646106,0.0439954132806582,0.259924316552460;0.210789010257336,-0.720846314743699,-0.660264025731496;0.158316897012707,0.691697183838920,-0.704621008762565]	[0.987218614456460,0.0898955021829083,0.131598654848558;-0.0433753334297964,-0.643007191295242,0.764630847136354;0.153355755420268,-0.760565941013590,-0.630889421095006]

%T1 [1211.73583034678;1170.36660949541;7004.81159346973]

%T3 [-51.2358261432556;1148.96076927118;4839.52252863309]	[177.273559589519;1063.99349236794;4384.46396418620]	[-79.3956393285016;-972.057735927848;-4552.98558763610]
%T4 [-138.495273259367;1153.08573900645;4382.19600111107]	[110.697836782706;1099.47605559421;4089.62085448020]	[2.30906397068532;-1005.21953158115;-4238.71297066332]	[-132.297431820221;992.723075524427;4183.40291316619]
%T5  [7.06293835026781;727.360197727757;4223.87820458199]	[249.096510231047;680.460395917735;3820.64580286953]	[-142.980767993439;-602.835849530874;-4146.27141614836]	[3.56804180026438;562.556914161170;3865.16613066837]	[-191.282591760855;409.851556123469;4325.92869699729]